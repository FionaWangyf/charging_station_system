import{ag as d,H as x,o as p,c as y,a as r,Q as a,I as c,u as O,M as h,r as b,p as M,aq as E,J as A,O as w,K as I,P as C,a6 as S,b as D,w as B,aw as W,ax as L,at as U}from"./vue-vendor-3mIAIgYc.js";import{u as Q,E as q,i as R}from"./element-plus-DIm5Xxzl.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=e(t);fetch(t.href,o)}})();const Y=(i,l)=>{const e=i.__vccOpts||i;for(const[s,t]of l)e[s]=t;return e},j={};function z(i,l){const e=d("router-view");return p(),x(e)}const H=Y(j,[["render",z]]),J={class:"topbar"},K={class:"admin"},G={__name:"TopBar",setup(i){return(l,e)=>{const s=d("el-icon");return p(),y("div",J,[e[1]||(e[1]=r("div",{class:"title"},"智能充电桩管理系统",-1)),r("div",K,[a(s,{class:"avatar"},{default:c(()=>[a(O(Q))]),_:1}),e[0]||(e[0]=r("span",{class:"name"},"Admin",-1))])])}}},k=Y(G,[["__scopeId","data-v-23e87998"]]),X={__name:"SidebarMenu",setup(i){return(l,e)=>{const s=d("el-icon"),t=d("router-link"),o=d("el-menu-item"),u=d("el-menu");return p(),x(u,{"default-active":l.$route.path,class:"el-menu-vertical-demo","background-color":"#1E6BFF","text-color":"#fff","active-text-color":"#ffd04b",router:""},{default:c(()=>[a(o,{index:"/charging"},{default:c(()=>[a(s,null,{default:c(()=>e[0]||(e[0]=[r("i",{class:"el-icon-battery"},null,-1)])),_:1,__:[0]}),a(t,{to:"/charging"},{default:c(()=>e[1]||(e[1]=[h("充电桩管理")])),_:1,__:[1]})]),_:1}),a(o,{index:"/waiting"},{default:c(()=>[a(s,null,{default:c(()=>e[2]||(e[2]=[r("i",{class:"el-icon-truck"},null,-1)])),_:1,__:[2]}),a(t,{to:"/waiting"},{default:c(()=>e[3]||(e[3]=[h("等候车辆")])),_:1,__:[3]})]),_:1}),a(o,{index:"/report"},{default:c(()=>[a(s,null,{default:c(()=>e[4]||(e[4]=[r("i",{class:"el-icon-data-analysis"},null,-1)])),_:1,__:[4]}),a(t,{to:"/report"},{default:c(()=>e[5]||(e[5]=[h("报表统计")])),_:1,__:[5]})]),_:1})]),_:1},8,["default-active"])}}},N=Y(X,[["__scopeId","data-v-faba54cd"]]),Z="";async function v(i,l={}){const e={headers:{"Content-Type":"application/json"},credentials:"include",...l};e.body&&typeof e.body=="object"&&(e.body=JSON.stringify(e.body));const s=await fetch(`${Z}${i}`,e),t=await s.json();if(!s.ok)throw new Error(t.message||"请求失败");return t}const $={admin:{getPilesStatus:()=>v("/api/admin/piles/status"),startPile:i=>v("/api/admin/pile/start",{method:"POST",body:{pile_id:i}}),stopPile:(i,l=!1)=>v("/api/admin/pile/stop",{method:"POST",body:{pile_id:i,force:l}}),getQueueInfo:()=>v("/api/admin/queue/info"),getOverview:()=>v("/api/admin/overview")},statistics:{getOverview:()=>v("/api/statistics/overview"),getDaily:(i=7)=>v(`/api/statistics/daily?days=${i}`),getPileUsage:()=>v("/api/statistics/pile-usage"),getTimePeriod:()=>v("/api/statistics/time-period")}},ee={__name:"ChargingPileTable",setup(i){const l=b([]),e=b(!1);async function s(){e.value=!0;try{const n=await $.admin.getPilesStatus();l.value=n.data.piles.map(m=>({name:m.name,power:m.db_status==="available",isCharging:m.current_session!==null,isFault:m.db_status==="fault",count:m.total_charges||0,duration:Number(m.total_power||0).toFixed(1),energy:Number(m.total_revenue||0).toFixed(1),id:m.id}))}catch(n){q.error("获取充电桩状态失败: "+n.message)}finally{e.value=!1}}async function t(n){try{n.power?(await $.admin.startPile(n.id),q.success(`充电桩 ${n.name} 已启动`)):(await $.admin.stopPile(n.id),q.success(`充电桩 ${n.name} 已停止`),n.isCharging=!1),await s()}catch(m){q.error("操作失败: "+m.message),n.power=!n.power}}function o(n){switch(n){case"待启动":return"warning";case"空闲":return"info";case"充电中":return"success";case"故障":return"danger";default:return""}}function u(n){return n.power?n.isFault?"故障":n.isCharging?"充电中":"空闲":"待启动"}return M(()=>{s(),setInterval(s,5e3)}),(n,m)=>{const f=d("el-table-column"),_=d("el-tag"),P=d("el-switch"),F=d("el-table"),V=E("loading");return A((p(),x(F,{data:l.value,style:{width:"100%"}},{default:c(()=>[a(f,{prop:"name",label:"充电桩"}),a(f,{label:"当前状态"},{default:c(({row:g})=>[a(_,{type:o(u(g)),"disable-transitions":""},{default:c(()=>[h(w(u(g)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"count",label:"累计充电次数"}),a(f,{prop:"duration",label:"充电总时长（h）"}),a(f,{prop:"energy",label:"总充电量（度）"}),a(f,{label:"启动"},{default:c(({row:g})=>[a(P,{modelValue:g.power,"onUpdate:modelValue":T=>g.power=T,disabled:g.isFault,onChange:T=>t(g)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1})]),_:1},8,["data"])),[[V,e.value]])}}},te={class:"full"},ae={class:"container"},se={class:"content"},ne={class:"table-wrapper"},oe={__name:"ChargingPileView",setup(i){return(l,e)=>(p(),y("div",te,[a(k),r("div",ae,[a(N),r("div",se,[e[0]||(e[0]=r("h2",null,"充电桩列表",-1)),r("div",ne,[a(ee)])])])]))}},re=Y(oe,[["__scopeId","data-v-2474b885"]]),ie={class:"header"},le={class:"count"},ue={class:"info-row"},ce={class:"info-row"},de={class:"info-row"},_e={class:"info-row"},pe={key:0,class:"empty"},me={__name:"WaitingPileCard",props:{pileName:String,queue:{type:Array,default:()=>[]}},setup(i){return(l,e)=>{const s=d("el-divider"),t=d("el-card");return p(),x(t,{shadow:"always",class:"pile-card"},{default:c(()=>[r("div",ie,[r("h3",null,w(i.pileName),1),r("span",le,"等候车辆数："+w(i.queue.length),1)]),(p(!0),y(C,null,S(i.queue,(o,u)=>(p(),y("div",{class:"vehicle",key:u},[r("div",ue,[e[0]||(e[0]=r("span",{class:"label"},"用户 ID：",-1)),h(w(o.userId),1)]),r("div",ce,[e[1]||(e[1]=r("span",{class:"label"},"电池容量：",-1)),h(w(o.capacity)+" 度",1)]),r("div",de,[e[2]||(e[2]=r("span",{class:"label"},"请求电量：",-1)),h(w(o.request)+" 度",1)]),r("div",_e,[e[3]||(e[3]=r("span",{class:"label"},"排队时长：",-1)),h(w(o.waitingTime)+" h",1)]),u<i.queue.length-1?(p(),x(s,{key:0})):I("",!0)]))),128)),i.queue.length===0?(p(),y("div",pe," 当前无等候车辆 ")):I("",!0)]),_:1})}}},fe=Y(me,[["__scopeId","data-v-c35a5305"]]),ge={class:"full"},ve={class:"container"},he={class:"content"},be={class:"grid"},ye={__name:"WaitingVehiclesView",setup(i){const l=b([]),e=b(!1);async function s(){e.value=!0;try{const u=(await $.admin.getQueueInfo()).data.queue_info;l.value=[{name:"快充桩 A",queue:u.charging_sessions.filter(n=>n.pile_id==="A").map(t)},{name:"快充桩 B",queue:u.charging_sessions.filter(n=>n.pile_id==="B").map(t)},{name:"慢充桩 C",queue:u.charging_sessions.filter(n=>n.pile_id==="C").map(t)},{name:"慢充桩 D",queue:u.charging_sessions.filter(n=>n.pile_id==="D").map(t)},{name:"慢充桩 E",queue:u.charging_sessions.filter(n=>n.pile_id==="E").map(t)}]}catch{ElMessage.error("获取队列信息失败")}finally{e.value=!1}}function t(o){return{userId:o.user_id,capacity:o.requested_amount,request:o.actual_amount||0,waitingTime:calculateWaitingTime(o.created_at)}}return M(()=>{s(),setInterval(s,3e3)}),(o,u)=>(p(),y("div",ge,[a(k),r("div",ve,[a(N),r("div",he,[u[0]||(u[0]=r("h2",null,"等候车辆",-1)),r("div",be,[(p(!0),y(C,null,S(l.value,n=>(p(),x(fe,{key:n.name,pileName:n.name,queue:n.queue},null,8,["pileName","queue"]))),128))])])])]))}},we=Y(ye,[["__scopeId","data-v-100c9b5a"]]),$e={__name:"ReportTable",props:{report:{type:Array,default:()=>[]}},setup(i){return(l,e)=>{const s=d("el-table-column"),t=d("el-table");return p(),x(t,{data:i.report,border:"",stripe:"",style:{width:"100%"}},{default:c(()=>[a(s,{prop:"id",label:"充电桩编号",width:"180"}),a(s,{prop:"count",label:"累计充电次数",width:"200"}),a(s,{prop:"time",label:"累计充电时长（h）",width:"220"}),a(s,{prop:"kwh",label:"累计充电量（kWh）",width:"220"}),a(s,{prop:"chargeFee",label:"累计充电费用（元）",width:"220"}),a(s,{prop:"serviceFee",label:"累计服务费用（元）",width:"220"}),a(s,{prop:"totalFee",label:"累计总费用（元）",width:"220"}),a(s,{prop:"others",label:"备注",width:"125"})]),_:1},8,["data"])}}},xe={class:"full"},Ye={class:"container"},Pe={class:"content"},qe={class:"toolbar"},Fe={__name:"ReportView",setup(i){const l=b([]),e=b(!1),s=b("日"),t=b(new Date),o=D(()=>{switch(s.value){case"日":return"date";case"周":return"week";case"月":return"month";default:return"date"}}),u=D(()=>{switch(s.value){case"日":return"YYYY/MM/DD";case"周":return"gggg [第] ww [周]";case"月":return"YYYY/MM";default:return"YYYY/MM/DD"}}),n=D(()=>{switch(s.value){case"日":return"YYYY-MM-DD";case"周":return"gggg-[W]WW";case"月":return"YYYY-MM";default:return"YYYY-MM-DD"}});async function m(){e.value=!0;try{let f;switch(s.value){case"日":f=await $.statistics.getDaily(1);break;case"周":f=await $.statistics.getDaily(7);break;case"月":f=await $.statistics.getDaily(30);break}l.value=f.data.map(_=>({id:_.pile_id||"Unknown",count:_.charging_count||0,time:Number(_.power_consumed||0).toFixed(1),kwh:Number(_.power_consumed||0).toFixed(1),chargeFee:Number(_.revenue||0).toFixed(2),serviceFee:(Number(_.revenue||0)*.2).toFixed(2),totalFee:Number(_.revenue||0).toFixed(2)}))}catch{ElMessage.error("获取统计数据失败")}finally{e.value=!1}}return B([s,t],()=>{m()}),M(()=>{m()}),(f,_)=>{const P=d("el-radio-button"),F=d("el-radio-group"),V=d("el-date-picker");return p(),y("div",xe,[a(k),r("div",Ye,[a(N),r("div",Pe,[_[2]||(_[2]=r("h2",null,"报表统计",-1)),r("div",qe,[a(F,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=g=>s.value=g),size:"small"},{default:c(()=>[a(P,{label:"日"}),a(P,{label:"周"}),a(P,{label:"月"})]),_:1},8,["modelValue"]),a(V,{modelValue:t.value,"onUpdate:modelValue":_[1]||(_[1]=g=>t.value=g),type:o.value,format:u.value,"value-format":n.value,placeholder:"选择日期",size:"small",style:{"margin-left":"12px"}},null,8,["modelValue","type","format","value-format"])]),a($e,{report:l.value},null,8,["report"])])])])}}},Ve=Y(Fe,[["__scopeId","data-v-46eb29a5"]]),De=[{path:"/",redirect:"/charging"},{path:"/charging",component:re},{path:"/waiting",component:we},{path:"/report",component:Ve}],Me=W({history:L(),routes:De});U(H).use(Me).use(R).mount("#app");
